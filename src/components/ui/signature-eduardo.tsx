"use client";

import { useEffect, useRef } from "react";

interface SignatureEduardoProps {
  startDelay?: number;
  skipAnimation?: boolean;
}

export function SignatureEduardo({ startDelay = 0, skipAnimation = false }: SignatureEduardoProps = {}) {
  const pathRef = useRef<SVGPathElement | null>(null);

  useEffect(() => {
    const path = pathRef.current;
    if (!path) return;

    const length = path.getTotalLength();

    // Si skipAnimation es true, mostrar directamente sin animar
    if (skipAnimation) {
      path.style.strokeDasharray = `${length} ${length}`;
      path.style.strokeDashoffset = "0";
      path.style.strokeOpacity = "0.25";
      path.style.fill = "currentColor";
      path.style.fillOpacity = "1";
      path.style.transition = "none";
      return;
    }

    let frame = 0;
    const totalFrames = 800;
    let handle = 0 as number | 0;

    path.style.strokeDasharray = `${length} ${length}`;
    path.style.strokeDashoffset = `${length}`;
    path.style.strokeOpacity = "1";
    path.style.fill = "currentColor";
    path.style.fillOpacity = "0";
    path.style.transition = "none";

    const draw = () => {
      const progress = frame / totalFrames;

      if (progress > 0.16) {
        path.style.strokeDashoffset = "0";

        // Suavizar la transición de relleno y del trazo
        requestAnimationFrame(() => {
          path.style.transition = "fill-opacity 0.8s ease-out, stroke-opacity 0.8s ease-out";
          path.style.fillOpacity = "1";
          path.style.strokeOpacity = "0.25";
        });

        cancelAnimationFrame(handle);
        return;
      }

      frame++;
      path.style.strokeDashoffset = `${Math.floor(length * (1 - progress))}`;
      handle = requestAnimationFrame(draw);
    };

    // Esperar el delay antes de iniciar la animación
    const startTimeoutId = setTimeout(() => {
      handle = requestAnimationFrame(draw);
    }, startDelay);

    return () => {
      clearTimeout(startTimeoutId);
      cancelAnimationFrame(handle);
    };
  }, [startDelay, skipAnimation]);

  return (
    <div className="mt-6 flex justify-center">
      <svg
        width="560"
        height="120"
        viewBox="0 0 148.16666 31.75"
        xmlns="http://www.w3.org/2000/svg"
        className="max-w-full text-foreground"
        aria-hidden="true"
      >
        <g>
          <path
            ref={pathRef}
            id="firma_path"
            d="M 14.491221,19.540235 V 9.5571144 h 1.882532 V 13.678715 H 20.08177 V 9.5571144 h 1.882532 V 19.540235 H 20.08177 v -4.15013 h -3.708017 v 4.15013 z m 12.635784,0.19966 q -1.055359,0 -1.86827,-0.4421 -0.79865,-0.45638 -1.255022,-1.26929 -0.44211,-0.82717 -0.44211,-1.93958 v -0.17114 q 0,-1.1124 0.44211,-1.92532 0.44211,-0.82717 1.24076,-1.26928 0.79865,-0.45637 1.854009,-0.45637 1.041097,0 1.811224,0.47063 0.770127,0.45638 1.197975,1.28355 0.427848,0.81291 0.427848,1.89679 v 0.61325 h -5.14844 q 0.02853,0.72734 0.541941,1.18372 0.513418,0.45636 1.255021,0.45636 0.755866,0 1.112405,-0.32801 0.356541,-0.32802 0.541942,-0.72735 l 1.468945,0.77013 q -0.199662,0.37081 -0.584726,0.81291 -0.370802,0.42785 -0.998312,0.7416 -0.627511,0.2995 -1.5973,0.2995 z m -1.725654,-4.54945 h 3.308693 q -0.05705,-0.61325 -0.499157,-0.98405 -0.427848,-0.3708 -1.126667,-0.3708 -0.727342,0 -1.15519,0.3708 -0.427848,0.3708 -0.527679,0.98405 z m 7.501599,7.20211 v -1.56877 h 3.850633 q 0.399325,0 0.399325,-0.42785 v -1.7827 h -0.256709 q -0.114092,0.24244 -0.35654,0.48489 -0.242447,0.24245 -0.656034,0.39932 -0.413586,0.15688 -1.055359,0.15688 -0.827173,0 -1.454684,-0.3708 -0.613248,-0.38506 -0.955527,-1.05536 -0.342279,-0.67029 -0.342279,-1.54025 v -4.22144 h 1.796963 v 4.07882 q 0,0.79866 0.385063,1.19797 0.399325,0.39933 1.126667,0.39933 0.827174,0 1.283544,-0.54194 0.456372,-0.5562 0.456372,-1.54026 v -3.59392 h 1.796962 v 8.32878 q 0,0.72734 -0.427848,1.15519 -0.427848,0.44211 -1.140928,0.44211 z m 8.143367,-0.75587 v -0.96978 h 0.556202 q 0.656035,0 0.656035,-0.65604 v -0.45637 h -0.242448 q -0.570465,0 -0.955528,-0.34228 -0.370801,-0.34227 -0.370801,-0.86995 0,-0.57047 0.370801,-0.92701 0.385063,-0.35654 0.955528,-0.35654 0.584726,0 0.955528,0.3708 0.370801,0.35654 0.370801,0.96979 v 1.64009 q 0,1.59729 -1.5973,1.59729 z m 10.667675,-1.89679 q -1.15519,0 -2.03941,-0.41359 -0.884219,-0.41359 -1.383375,-1.18371 -0.499157,-0.77013 -0.499157,-1.854 v -0.39933 h 1.854009 v 0.39933 q 0,0.89848 0.556203,1.35484 0.556203,0.44212 1.51173,0.44212 0.969789,0 1.440422,-0.38507 0.484895,-0.38506 0.484895,-0.98405 0,-0.41358 -0.242448,-0.67029 -0.228185,-0.25671 -0.684557,-0.41359 -0.442109,-0.17114 -1.083881,-0.31376 l -0.328017,-0.0713 q -1.026836,-0.22819 -1.76844,-0.57047 -0.727342,-0.35654 -1.126666,-0.927 -0.385064,-0.57046 -0.385064,-1.48321 0,-0.91274 0.427849,-1.55451 0.442109,-0.65603 1.226497,-0.9983206 0.798651,-0.35654 1.868271,-0.35654 1.06962,0 1.896793,0.3708 0.841435,0.3565506 1.312068,1.0838906 0.484895,0.71308 0.484895,1.79696 v 0.42785 H 53.3826 v -0.42785 q 0,-0.57047 -0.228186,-0.91274 -0.213923,-0.35654 -0.627511,-0.51342 -0.413586,-0.17114 -0.98405,-0.17114 -0.855697,0 -1.269283,0.32802 -0.399325,0.31375 -0.399325,0.86995 0,0.37081 0.185401,0.62751 0.199662,0.25671 0.584725,0.42785 0.385064,0.17115 0.984052,0.2995 l 0.328016,0.0713 q 1.069621,0.22819 1.854009,0.58473 0.79865,0.35654 1.24076,0.94126 0.44211,0.58473 0.44211,1.49748 0,0.91274 -0.470634,1.61155 -0.456371,0.68456 -1.312067,1.08389 -0.841435,0.38506 -1.996625,0.38506 z m 8.59976,0 q -1.055358,0 -1.896793,-0.42785 -0.841434,-0.42784 -1.326329,-1.24076 -0.484894,-0.81291 -0.484894,-1.95384 v -0.22818 q 0,-1.14093 0.484894,-1.95384 0.484895,-0.81291 1.326329,-1.24076 0.841435,-0.42785 1.896793,-0.42785 1.055359,0 1.896793,0.42785 0.841435,0.42785 1.32633,1.24076 0.484894,0.81291 0.484894,1.95384 v 0.22818 q 0,1.14093 -0.484894,1.95384 -0.484895,0.81292 -1.32633,1.24076 -0.841434,0.42785 -1.896793,0.42785 z m 0,-1.5973 q 0.827174,0 1.369114,-0.52768 0.541941,-0.54194 0.541941,-1.54025 v -0.14262 q 0,-0.99831 -0.541941,-1.52599 -0.52768,-0.54194 -1.369114,-0.54194 -0.827173,0 -1.369114,0.54194 -0.54194,0.52768 -0.54194,1.52599 v 0.14262 q 0,0.99831 0.54194,1.54025 0.541941,0.52768 1.369114,0.52768 z m 6.132485,4.24996 v -1.56877 h 3.850631 q 0.399325,0 0.399325,-0.42785 v -1.7827 h -0.256708 q -0.114092,0.24244 -0.356538,0.48489 -0.242447,0.24245 -0.656035,0.39932 -0.413588,0.15688 -1.05536,0.15688 -0.827176,0 -1.454685,-0.3708 -0.613247,-0.38506 -0.955531,-1.05536 -0.342275,-0.67029 -0.342275,-1.54025 v -4.22144 h 1.796961 v 4.07882 q 0,0.79866 0.385063,1.19797 0.399326,0.39933 1.126672,0.39933 0.827168,0 1.283544,-0.54194 0.456367,-0.5562 0.456367,-1.54026 v -3.59392 h 1.796961 v 8.32878 q 0,0.72734 -0.427842,1.15519 -0.427851,0.44211 -1.140935,0.44211 z m 11.580411,-2.85232 V 9.5571144 h 6.417721 v 1.7113806 h -4.53519 v 2.3817 h 4.13586 v 1.71139 h -4.13586 v 2.46726 h 4.62076 v 1.71139 z m 10.810311,0.19966 q -0.84144,0 -1.58304,-0.41359 -0.72734,-0.42784 -1.16946,-1.24075 -0.499157,-0.81292 -0.499157,-1.96811 v -0.22818 q 0,-1.15519 0.44211,-1.9681 0.44212,-0.81292 1.16946,-1.2265 0.72733,-0.42785 1.58304,-0.42785 0.64177,0 1.06961,0.15687 0.44211,0.14262 0.71308,0.37081 0.27098,0.22819 0.41359,0.4849 h 0.25671 V 9.5571144 h 1.79696 v 9.9831206 h -1.76843 v -0.8557 h -0.25671 q -0.24246,0.39933 -0.75587,0.72735 -0.49916,0.32801 -1.46894,0.32801 z m 0.54194,-1.56878 q 0.82717,0 1.38337,-0.52768 0.55621,-0.54194 0.55621,-1.56877 v -0.14262 q 0,-1.02684 -0.55621,-1.55452 -0.54194,-0.54193 -1.38337,-0.54193 -0.82718,0 -1.38338,0.54193 -0.55621,0.52768 -0.55621,1.55452 v 0.14262 q 0,1.02683 0.55621,1.56877 0.5562,0.52768 1.38338,0.52768 z m 8.40008,1.48321 q -0.82717,0 -1.45468,-0.3708 -0.61325,-0.38506 -0.95553,-1.05536 -0.34227,-0.67029 -0.34227,-1.54025 v -4.22144 h 1.79696 v 4.07882 q 0,0.79866 0.38506,1.19797 0.39933,0.39933 1.12667,0.39933 0.82717,0 1.28354,-0.54194 0.456381,-0.5562 0.456381,-1.54026 v -3.59392 h 1.79696 v 7.07376 h -1.76845 v -0.927 h -0.256711 q -0.17113,0.35653 -0.64177,0.69881 -0.47063,0.34228 -1.42616,0.34228 z m 8.285991,0.0856 q -0.75587,0 -1.35485,-0.25671 -0.59899,-0.27097 -0.95553,-0.77012 -0.34228,-0.51342 -0.34228,-1.24076 0,-0.72735 0.34228,-1.21224 0.35654,-0.49915 0.96979,-0.7416 0.62751,-0.25671 1.42616,-0.25671 h 1.93958 v -0.39933 q 0,-0.49915 -0.31376,-0.81291 -0.31375,-0.32802 -0.99831,-0.32802 -0.6703,0 -0.99831,0.31376 -0.32802,0.2995 -0.42785,0.78439 l -1.65435,-0.55621 q 0.17115,-0.54194 0.54195,-0.98404 0.38506,-0.45638 1.01257,-0.72735 0.64177,-0.28523 1.55451,-0.28523 1.39764,0 2.21055,0.69882 0.81292,0.69882 0.81292,2.02515 v 2.63839 q 0,0.42785 0.39932,0.42785 h 0.57046 v 1.48321 h -1.19797 q -0.52768,0 -0.86996,-0.25671 -0.34228,-0.25671 -0.34228,-0.68456 v -0.0142 h -0.27097 q -0.0571,0.17115 -0.25671,0.45637 -0.19966,0.27097 -0.6275,0.4849 -0.42786,0.21392 -1.16946,0.21392 z m 0.31375,-1.45468 q 0.75587,0 1.22651,-0.41359 0.48489,-0.42785 0.48489,-1.12667 v -0.14261 h -1.81123 q -0.49915,0 -0.78438,0.21393 -0.28524,0.21392 -0.28524,0.59898 0,0.38506 0.2995,0.62751 0.29949,0.24245 0.86995,0.24245 z m 5.73315,1.25502 v -7.07376 h 1.76845 v 0.79865 h 0.25671 q 0.15687,-0.42785 0.51342,-0.62751 0.3708,-0.19966 0.85569,-0.19966 h 0.85569 v 1.5973 h -0.88422 q -0.68455,0 -1.12666,0.3708 -0.44211,0.35654 -0.44211,1.11241 v 4.02177 z m 8.24322,0.19966 q -0.84143,0 -1.58303,-0.41359 -0.72735,-0.42784 -1.16946,-1.24075 -0.44211,-0.81292 -0.44211,-1.96811 v -0.22818 q 0,-1.15519 0.44211,-1.9681 0.44211,-0.81292 1.16946,-1.2265 0.72733,-0.42785 1.58303,-0.42785 0.64177,0 1.06962,0.15687 0.44211,0.14262 0.71308,0.37081 0.27097,0.22819 0.41358,0.4849 h 0.25671 V 9.5571444 h 1.79697 v 9.9831206 h -1.76844 v -0.8557 h -0.25671 q -0.24245,0.39933 -0.75587,0.72735 -0.49915,0.32801 -1.46894,0.32801 z m 0.54194,-1.56878 q 0.82718,0 1.38338,-0.52768 0.5562,-0.54194 0.5562,-1.56877 v -0.14262 q 0,-1.02684 -0.5562,-1.55452 -0.54194,-0.54193 -1.38338,-0.54193 -0.82717,0 -1.38337,0.54193 -0.55621,0.52768 -0.55621,1.55452 v 0.14262 q 0,1.02683 0.55621,1.56877 0.5562,0.52768 1.38337,0.52768 z m 9.0704,1.56878 q -1.05536,0 -1.8968,-0.42785 -0.84143,-0.42784 -1.32633,-1.24076 -0.4849,-0.81291 -0.4849,-1.95384 v -0.22818 q 0,-1.14093 0.4849,-1.95384 0.4849,-0.81291 1.32633,-1.24076 0.84144,-0.42785 1.8968,-0.42785 1.05535,0 1.89679,0.42785 0.84143,0.42785 1.32633,1.24076 0.48489,0.81291 0.48489,1.95384 v 0.22818 q 0,1.14093 -0.48489,1.95384 -0.4849,0.81292 -1.32633,1.24076 -0.84144,0.42785 -1.89679,0.42785 z m 0,-1.5973 q 0.82716,0 1.36911,-0.52768 0.54194,-0.54194 0.54194,-1.54025 v -0.14262 q 0,-0.99831 -0.54194,-1.52599 -0.52768,-0.54194 -1.36911,-0.54194 -0.82718,0 -1.36912,0.54194 -0.54195,0.52768 -0.54195,1.52599 v 0.14262 q 0,0.99831 0.54195,1.54025 0.54194,0.52768 1.36912,0.52768 z"
            fill="transparent"
            stroke="currentColor"
            strokeWidth={0.3}
            strokeLinecap="round"
            strokeLinejoin="round"
          />
        </g>
      </svg>
    </div>
  );
}
